# Декомпозиция на функциональные компоненты

**Цель:** В этом ДЗ вы научитесь декомпозировать на функциональные компоненты.


**Кейс:** [Собственный](../Homework_01)


## Модели предметной области и функциональная декомпозиция 

### Способ 1. Декомпозиция на основе функциональных модулей
Этот метод предполагает разделение всей системы на несколько крупных функциональных блоков, каждый из которых отвечает за определенную часть общего процесса.

Система делится на следующие модули:

**Kafka Consumer Module:**
* Чтение данных из топиков Kafka.
* Передача данных в промежуточную зону хранения.

**ETL Module:**
* Преобразование данных из промежуточного хранилища в формат, подходящий для загрузки в реляционную базу данных.
* Генерация SQL-запросов для создания/обновления схем баз данных.

**Data Platform Module:**
* Хранение метаданных о структурах топиков, схемах баз данных и правилах преобразования данных.
* Предоставление веб-интерфейса для просмотра состояния разбора топиков, инициации новых процессов загрузки, изменения набора разбираемых атрибутов и других операций.
* Отслеживание состояния процессов загрузки данных.
* Выявление ошибок и уведомление ответственных лиц.


### Способ 2. Декомпозиция на основе микросервисной архитектуры

Этот подход предполагает разделение системы на множество независимых сервисов, каждый из которых решает одну узкую задачу.

Система делится на следующие сервисы:

**Kafka Consumer Service:**
* Чтение данных из топиков Kafka.
* Передача данных в промежуточную зону хранения.

**Schema Generator Service:**
* Генерация схем баз данных на основе спецификаций топиков.

**Database Schema Migration Service:**
* Проводит модификацию схемы БД.

**ETL Service:**
* Преобразование данных из промежуточного хранилища в формат, подходящий для загрузки в реляционную базу данных.

**Metadata Management Service:**
* Управление метаданными о структурах топиков, схемах баз данных и правилах преобразования данных.

**Monitoring Service:**
* Отслеживание состояния процессов загрузки данных.
* Выявление ошибок и уведомление ответственных лиц.

**UI Web Application:**
* Предоставление единого интерфейса для доступа ко всем сервисам.

**Auth Service:**
* Сервис аутентификации.

## Сценарии изменений и оценка их стоимости

### Сценарий 1: Добавление нового источника данных

**Описание:** Необходимо подключить новый источник данных (новый топик Kafka).

**Вероятность:** Высокая, так как бизнес постоянно развивается и появляются новые источники данных.

### Стоимость изменений

**Способ 1:**
Низкая, потребуется создание новых объектов в БД, изменение конфигурации для модулей Kafka Consumer и ETL, а также поднятие дополнительных воркеров, это можно автоматизироывть.

**Способ 2:** 
Низкая, потребуется поднять дополнительные экземпляры для сервисов Kafka Consumer и ETL и создать объекты в БД, это произойдет в автоматическом режиме..

### Сценарий 2: Изменение структуры данных в существующем топике

**Описание:** Требуется обновить структуру существующих топиков Kafka и соответствующие схемы баз данных.
**Вероятность:** Средняя, так как форматы данных проходят долгий период согласования и закрепляются в контрактах, но в связи с изменением бизнес-требований изменения всё же возможны.

### Стоимость изменений

**Способ 1:**
Низкая, изменения пройдут на уровне ETL и схемы конечной реляционной БД в автоматическом режиме.

**Способ 2:**
Низкая, изменения пройдут на уровне ETL и схемы конечной реляционной БД в автоматическом режиме.

### Сценарий 3: Отказ от Kafka в пользу другого инструмента

**Описание:** На уровне IT-инфраструктуры может быть выбран другой инструмент в качестве очереди сообщений.
**Вероятность:** Низкая, потребуются серьезные изменения в очень большом количестве компонент.

### Стоимость изменений

**Способ 1:**
Средняя/высокая, в завимости от нового формата данных изменения могут заключаться в замене Kafka Consumer Module на модуль разбора нового типа источника с преобразованием в формат, понятный ETL сервису. 

**Способ 2:**
Средняя, потребуются доработки лишь в части микросервисов. Если закладывать подобный сценарий во время разработки, то можно проектировать сервисы с этим учетом и упростить переход в дальнейшем.

## Сравнительный анализ и выводы
| Критерий	 | Способ 1	| Способ 2 |
|---|---|---|
| Масштабируемость	| Средняя |	Высокая |
| Независимость модулей	| Средняя	| Высокая |
| Управляемость	| Высокая	| Средняя |
| Стоимость изменений	| Средняя	| Низкая |
| Сложность координации	| Средняя	| Высокая |

Исходя из приведенных критериев, первый способ более прост в управлении, а второй способ имеет преимущества при масштабировании и изменениях в отдельных сервисах.

### Способ 1

**Плюсы:**
* Четкое разделение ответственности между модулями.
* Высокая сопряженость. 

**Минусы:**
* Необходимость поддержания четких договоренностей (формат конфигов) между модулями.

### Способ 2

**Плюсы:**
* Высокая степень независимости сервисов.
* Простота масштабирования и замены отдельных сервисов.

**Минусы:**
* Увеличенная сложность в управлении и координации множества сервисов.
* Потребность в дополнительных инструментах для обеспечения взаимодействия между сервисами.

